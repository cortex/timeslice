<!doctype html>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<canvas id="timeslice"></canvas>
<style>
    body {
        background-color: black;
        margin: 0;
        padding: 0;
        height: 100%;
        overflow: hidden;
    }
    canvas {
        width: 100%;
        height: 100%;
        background-color: black;
    }
</style>
<script>
    const canvas = document.getElementById("timeslice");

    const ctx = canvas.getContext("2d");
    ctx.globalCompositeOperation = "destination-atop";
    const size = 200;
    const resize = () => {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        const scale = Math.min(window.innerWidth, window.innerHeight) / size;
        ctx.scale(scale, scale);
    };
    window.addEventListener("resize", resize);
    resize();

    const millisPerDay = 24 * 60 * 60 * 1000;
    // scale so 0.0
    var k = 1;
    let prevRadius = 0;
    const drawHand = (label, millisOfDay, part) => {
        const fraction = (millisOfDay % part) / part;
        const radius =
            90 * (Math.log(1 + (k * part) / millisPerDay) / Math.log(1 + k));
        if (radius < 5) return;
        radiusDelta = prevRadius - radius;
        // console.log(radiusDelta);
        if (Math.abs(radiusDelta) < 6) {
            return;
        }
        prevRadius = radius;
        const blueTint = Math.min(40, Math.floor((radius / 90) * 30));

        ctx.save();
        const angle = 1.5 * Math.PI + Math.PI * 2 * fraction;
        const x = 100 + radius * Math.cos(angle);
        const y = 100 + radius * Math.sin(angle);
        ctx.translate(x, y);
        ctx.beginPath();
        ctx.fillStyle = "red";
        ctx.fill();
        ctx.restore();

        ctx.beginPath();
        ctx.arc(
            100,
            100,
            radius,
            1.5 * Math.PI,
            1.5 * Math.PI + Math.PI * 2 * fraction,
        );
        ctx.strokeStyle = `rgba(${255 - blueTint}, ${255 - blueTint}, 255, 0.2)`;
        ctx.lineWidth = radius / 20;
        ctx.lineTo(100, 100);
        ctx.fillStyle = `rgba(${255 - 255 * (radius / 100)}, 0,0,0.8)`;
        ctx.fill();
        ctx.restore();
        ctx.font = "bold 4px sans";
        ctx.fillStyle = "white";
        ctx.textAlign = "right";
        // ctx.fillText(label, 98, 100 - radius);
    };
    const frame = () => {
        const now = new Date();
        const millisOfDay =
            now.getHours() * 60 * 60 * 1000 +
            now.getMinutes() * 60 * 1000 +
            now.getSeconds() * 1000 +
            now.getMilliseconds();
        ctx.fillStyle = "rgba(0, 0, 0, 0.1)";
        ctx.fillRect(0, 0, 200, 200);
        drawHand("1 d", millisOfDay, 24 * 60 * 60 * 1000);
        drawHand("18 h", millisOfDay, 18 * 60 * 60 * 1000);
        drawHand("12 h", millisOfDay, 12 * 60 * 60 * 1000);
        drawHand("8 h", millisOfDay, 8 * 60 * 60 * 1000);
        drawHand("6 h", millisOfDay, 6 * 60 * 60 * 1000);
        drawHand("4 h", millisOfDay, 4 * 60 * 60 * 1000);
        drawHand("2 h", millisOfDay, 2 * 60 * 60 * 1000);
        drawHand("1 h", millisOfDay, 60 * 60 * 1000);
        drawHand("45 m", millisOfDay, 45 * 60 * 1000);
        drawHand("30 m", millisOfDay, 30 * 60 * 1000);
        drawHand("20 m", millisOfDay, 20 * 60 * 1000);
        drawHand("15 m", millisOfDay, 15 * 60 * 1000);
        drawHand("10 m", millisOfDay, 10 * 60 * 1000);
        drawHand("5 m", millisOfDay, 5 * 60 * 1000);
        drawHand("2 m", millisOfDay, 2 * 60 * 1000);
        drawHand("1 m", millisOfDay, 60 * 1000);
        drawHand("30 s", millisOfDay, 30 * 1000);
        drawHand("10 s", millisOfDay, 10 * 1000);
        drawHand("5 s", millisOfDay, 5 * 1000);
        drawHand("1 s", millisOfDay, 1000);
        drawHand("1 s", millisOfDay, 1000);
        drawHand("100 ms", millisOfDay, 100);
        drawHand("10 ms", millisOfDay, 10);
        drawHand("1 ms", millisOfDay, 1);
        window.requestAnimationFrame(frame);
    };
    window.addEventListener("wheel", (e) => {
        k += k * (e.deltaY / 500.0);
    });
    frame();
</script>
